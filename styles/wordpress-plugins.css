/**
 * WordPress 外掛樣式整合
 *
 * 此檔案包含所有 WordPress 外掛在前端需要的樣式覆蓋。
 * 與 components/wordpress/ 中的 JS 整合組件搭配使用。
 */

/*
 * =============================================================================
 * Code Block Pro (WordPress plugin)
 * =============================================================================
 *
 * 為什麼需要這些覆蓋：
 * - 外掛預設樣式與網站設計不一致（有 border/shadow/border-radius）
 * - @tailwindcss/typography 會覆蓋 pre 的 margin，造成程式碼區塊頂部間距過大
 * - 複製按鈕預設被 inline style 隱藏（需搭配 code-block-pro.tsx 的 JS 覆蓋）
 */

.wp-block-kevinbatdorf-code-block-pro {
  position: relative;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
}

/* 外掛的 macOS 視窗裝飾（紅黃綠圓點）下方有多餘間距 */
.wp-block-kevinbatdorf-code-block-pro > span:first-child:has(svg) {
  margin-bottom: 0;
  padding-bottom: 0;
}

/* typography 外掛會在 pre 上加 margin-top，破壞視窗裝飾與程式碼的視覺連續性 */
.prose .wp-block-kevinbatdorf-code-block-pro pre,
.prose .wp-block-kevinbatdorf-code-block-pro pre.shiki,
.wp-block-kevinbatdorf-code-block-pro > pre.shiki {
  margin-top: 0 !important;
  padding-top: 12px !important;
  border-radius: 0 !important;
  border: none !important;
  box-shadow: none !important;
}

/* 複製按鈕定位（display 由 JS 處理，因為外掛用 inline style 設定 display:none） */
.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button {
  position: absolute;
  top: 8px;
  right: 8px;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  opacity: 0.6;
  transition: opacity 0.2s;
}

.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button:hover {
  opacity: 1;
}

/* 外掛在按鈕內放了一個 pre/textarea 來存程式碼，視覺上不需要顯示 */
.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button-pre {
  display: none;
}

/* 複製按鈕有兩個 SVG：一般狀態 (without-check) 和複製成功 (with-check) */
.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button .with-check {
  visibility: hidden;
  position: absolute;
}

.wp-block-kevinbatdorf-code-block-pro
  .code-block-pro-copy-button
  .without-check {
  visibility: visible;
}

/*
 * =============================================================================
 * Mermaid 圖表
 * =============================================================================
 *
 * Dark mode 修正：Mermaid 預設不支援 dark mode，需要用 CSS 覆蓋 SVG 內的顏色。
 * 使用 !important 是因為 mermaid 會產生 inline styles。
 */

.dark .mermaid text {
  fill: #e2e8f0 !important;
}

.dark .mermaid .actor {
  fill: #e2e8f0 !important;
  stroke: #94a3b8 !important;
}

.dark .mermaid line {
  stroke: #94a3b8 !important;
}

.dark .mermaid .arrowhead {
  fill: #94a3b8 !important;
}

.dark .mermaid .note {
  fill: #fef3c7 !important;
  stroke: #f59e0b !important;
}

.dark .mermaid .note text {
  fill: #1e293b !important;
}

/*
 * =============================================================================
 * YouTube 嵌入影片響應式
 * =============================================================================
 *
 * WordPress 的 YouTube 嵌入會產生 figure.wp-block-embed-youtube 包裹 iframe。
 * iframe 預設有固定寬度（560px），在手機上會超出容器。
 * 使用 aspect-ratio 保持 16:9 比例，讓影片自適應容器寬度。
 */

.wp-block-embed-youtube,
.wp-block-embed iframe[src*="youtube"] {
  max-width: 100%;
}

.wp-block-embed-youtube .wp-block-embed__wrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
}

.wp-block-embed-youtube iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/*
 * =============================================================================
 * WordPress Group Block（系列文導覽等）
 * =============================================================================
 *
 * 用於包裝系列文連結、相關文章等內容區塊。
 * 風格與 details/blockquote 一致：圓角邊框、淺色背景。
 */

.wp-block-group {
  border-radius: var(--radius);
  border: 1px solid hsl(var(--border));
  background-color: hsl(var(--muted) / 0.3);
  padding: 1rem 1.25rem;
  margin-block: 1.5rem;
}

/* 第一個段落作為標題，用較小字體和 muted 顏色 */
.wp-block-group > p:first-child {
  font-size: 0.875rem;
  font-weight: 500;
  color: hsl(var(--muted-foreground));
  margin-bottom: 0.75rem;
}

/* 列表樣式調整 */
.wp-block-group > ol,
.wp-block-group > ul {
  margin: 0;
  padding-left: 1.25rem;
  font-size: 0.9375rem;
}

.wp-block-group > ol > li,
.wp-block-group > ul > li {
  padding-block: 0.25rem;
}

/* 連結樣式 */
.wp-block-group a {
  color: hsl(var(--foreground));
  text-decoration: underline;
  text-decoration-color: hsl(var(--primary) / 0.5);
  text-underline-offset: 3px;
  transition: text-decoration-color 0.2s;
}

.wp-block-group a:hover {
  text-decoration-color: hsl(var(--primary));
}

/* Dark mode 微調 */
.dark .wp-block-group {
  background-color: hsl(var(--muted) / 0.2);
}

/*
 * =============================================================================
 * Jetpack Tiled Gallery
 * =============================================================================
 *
 * Jetpack 的相片牆區塊，支援多欄並排顯示圖片。
 * WordPress 前端需要 Jetpack 的 CSS 才能正確顯示，這裡手動實作必要樣式。
 *
 * --gallery-gap: 共用間距變數，與 WordPress Gallery Block 統一
 */

.wp-block-jetpack-tiled-gallery {
  --gallery-gap: 8px;
  margin-block: 1.5rem;
}

.wp-block-jetpack-tiled-gallery .tiled-gallery__gallery {
  display: flex;
  flex-direction: column;
  gap: var(--gallery-gap);
}

.wp-block-jetpack-tiled-gallery .tiled-gallery__row {
  display: flex;
  gap: var(--gallery-gap);
}

.wp-block-jetpack-tiled-gallery .tiled-gallery__col {
  display: flex;
  flex-direction: column;
  gap: var(--gallery-gap);
}

.wp-block-jetpack-tiled-gallery .tiled-gallery__item {
  margin: 0;
  overflow: hidden;
  border-radius: var(--radius);
}

.wp-block-jetpack-tiled-gallery .tiled-gallery__item img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  margin: 0;
  border: none;
  border-radius: 0;
}

/*
 * =============================================================================
 * WordPress Gallery Block
 * =============================================================================
 *
 * 基於 WordPress Core 的 gallery/style.css 精簡版。
 * 支援 columns-N class 和 is-cropped 模式，保持與 WP 編輯器設定一致。
 *
 * --gallery-gap: 共用間距變數，與 Jetpack Tiled Gallery 統一
 */

.wp-block-gallery {
  --gallery-gap: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: var(--gallery-gap);
  list-style: none;
  padding: 0;
  margin: 0;
}

.wp-block-gallery > figure {
  margin: 0;
  overflow: hidden;
  border-radius: var(--radius);
  /* 手機優先：預設 2 欄 */
  width: calc(50% - var(--gallery-gap) / 2);
}

/* 桌面：根據 columns class 調整 */
@media (min-width: 600px) {
  .wp-block-gallery.columns-1 > figure {
    width: 100%;
  }

  .wp-block-gallery.columns-2 > figure {
    width: calc(50% - var(--gallery-gap) / 2);
  }

  .wp-block-gallery.columns-3 > figure {
    width: calc(33.333% - var(--gallery-gap) * 0.667);
  }

  .wp-block-gallery.columns-4 > figure {
    width: calc(25% - var(--gallery-gap) * 0.75);
  }

  /* 預設 3 欄（當沒有指定 columns 時） */
  .wp-block-gallery:not([class*="columns-"]) > figure,
  .wp-block-gallery.columns-default > figure {
    width: calc(33.333% - var(--gallery-gap) * 0.667);
  }
}

/* 裁切模式：強制正方形比例 */
.wp-block-gallery.is-cropped > figure {
  aspect-ratio: 1 / 1;
}

.wp-block-gallery.is-cropped > figure img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* 非裁切模式：保留原始比例 */
.wp-block-gallery:not(.is-cropped) > figure img {
  width: 100%;
  height: auto;
}
