@import "tailwindcss";
@plugin "@tailwindcss/typography";

@custom-variant dark (&:is(.dark *));

@utility container {
    margin-inline: auto;
    padding-inline: 2rem;
    @media (width >= theme(--breakpoint-sm)) {
        max-width: none;
    }
    @media (width >= 1400px) {
        max-width: 1400px;
    }
}

@theme {
    --font-sans:
        var(--font-sans), ui-sans-serif, system-ui, sans-serif,
        "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
        "Noto Color Emoji";

    --color-border: hsl(var(--border));
    --color-input: hsl(var(--input));
    --color-ring: hsl(var(--ring));
    --color-background: hsl(var(--background));
    --color-foreground: hsl(var(--foreground));

    --color-primary: hsl(var(--primary));
    --color-primary-foreground: hsl(var(--primary-foreground));

    --color-secondary: hsl(var(--secondary));
    --color-secondary-foreground: hsl(var(--secondary-foreground));

    --color-destructive: hsl(var(--destructive));
    --color-destructive-foreground: hsl(var(--destructive-foreground));

    --color-muted: hsl(var(--muted));
    --color-muted-foreground: hsl(var(--muted-foreground));

    --color-accent: hsl(var(--accent));
    --color-accent-foreground: hsl(var(--accent-foreground));

    --color-popover: hsl(var(--popover));
    --color-popover-foreground: hsl(var(--popover-foreground));

    --color-card: hsl(var(--card));
    --color-card-foreground: hsl(var(--card-foreground));

    --radius-lg: var(--radius);
    --radius-md: calc(var(--radius) - 2px);
    --radius-sm: calc(var(--radius) - 4px);

    --animate-accordion-down: accordion-down 0.2s ease-out;
    --animate-accordion-up: accordion-up 0.2s ease-out;

    @keyframes accordion-down {
        from {
            height: 0;
        }
        to {
            height: var(--radix-accordion-content-height);
        }
    }
    @keyframes accordion-up {
        from {
            height: var(--radix-accordion-content-height);
        }
        to {
            height: 0;
        }
    }
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
    *,
    ::after,
    ::before,
    ::backdrop,
    ::file-selector-button {
        border-color: var(--color-gray-200, currentcolor);
    }
}

@utility no-scrollbar {
    /* Hide scrollbar for Chrome, Safari and Opera */
    &::-webkit-scrollbar {
        display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

@layer base {
    :root {
        --background: 0 0% 100%;
        --foreground: 0 0% 3.9%;

        --card: 0 0% 100%;
        --card-foreground: 0 0% 3.9%;

        --popover: 0 0% 100%;
        --popover-foreground: 0 0% 3.9%;

        --primary: 0 0% 9%;
        --primary-foreground: 0 0% 98%;

        --secondary: 0 0% 96.1%;
        --secondary-foreground: 0 0% 9%;

        --muted: 0 0% 96.1%;
        --muted-foreground: 0 0% 45.1%;

        --accent: 0 0% 96.1%;
        --accent-foreground: 0 0% 9%;

        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 0 0% 98%;

        --border: 0 0% 89.8%;
        --input: 0 0% 89.8%;
        --ring: 0 0% 3.9%;

        --radius: 0.5rem;
    }

    .dark {
        --background: 0 0% 3.9%;
        --foreground: 0 0% 98%;

        --card: 0 0% 3.9%;
        --card-foreground: 0 0% 98%;

        --popover: 0 0% 3.9%;
        --popover-foreground: 0 0% 98%;

        --primary: 0 0% 98%;
        --primary-foreground: 0 0% 9%;

        --secondary: 0 0% 14.9%;
        --secondary-foreground: 0 0% 98%;

        --muted: 0 0% 14.9%;
        --muted-foreground: 0 0% 63.9%;

        --accent: 0 0% 14.9%;
        --accent-foreground: 0 0% 98%;

        --destructive: 0 62.8% 30.6%;
        --destructive-foreground: 0 0% 98%;

        --border: 0 0% 14.9%;
        --input: 0 0% 14.9%;
        --ring: 0 0% 83.1%;
    }
}

@layer base {
    * {
        @apply border-border;
    }

    body {
        @apply bg-background text-foreground;
    }
}

/*
 * Code Block Pro (WordPress plugin) 樣式整合
 *
 * 為什麼需要這些覆蓋：
 * - 外掛預設樣式與網站設計不一致（有 border/shadow/border-radius）
 * - @tailwindcss/typography 會覆蓋 pre 的 margin，造成程式碼區塊頂部間距過大
 * - 複製按鈕預設被 inline style 隱藏（需搭配 code-block-pro.tsx 的 JS 覆蓋）
 */

.wp-block-kevinbatdorf-code-block-pro {
    position: relative;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
}

/* 外掛的 macOS 視窗裝飾（紅黃綠圓點）下方有多餘間距 */
.wp-block-kevinbatdorf-code-block-pro > span:first-child:has(svg) {
    margin-bottom: 0;
    padding-bottom: 0;
}

/* typography 外掛會在 pre 上加 margin-top，破壞視窗裝飾與程式碼的視覺連續性 */
.prose .wp-block-kevinbatdorf-code-block-pro pre,
.prose .wp-block-kevinbatdorf-code-block-pro pre.shiki,
.wp-block-kevinbatdorf-code-block-pro > pre.shiki {
    margin-top: 0 !important;
    padding-top: 12px !important;
    border-radius: 0 !important;
    border: none !important;
    box-shadow: none !important;
}

/* 複製按鈕定位（display 由 JS 處理，因為外掛用 inline style 設定 display:none） */
.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button {
    position: absolute;
    top: 8px;
    right: 8px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    opacity: 0.6;
    transition: opacity 0.2s;
}

.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button:hover {
    opacity: 1;
}

/* 外掛在按鈕內放了一個 pre/textarea 來存程式碼，視覺上不需要顯示 */
.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button-pre {
    display: none;
}

/* 複製按鈕有兩個 SVG：一般狀態 (without-check) 和複製成功 (with-check) */
.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button .with-check {
    visibility: hidden;
    position: absolute;
}

.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button .without-check {
    visibility: visible;
}

/* Mermaid dark mode 修正 */
.dark .mermaid text {
    fill: #e2e8f0 !important;
}

.dark .mermaid .actor {
    fill: #e2e8f0 !important;
    stroke: #94a3b8 !important;
}

.dark .mermaid line {
    stroke: #94a3b8 !important;
}

.dark .mermaid .arrowhead {
    fill: #94a3b8 !important;
}

.dark .mermaid .note {
    fill: #fef3c7 !important;
    stroke: #f59e0b !important;
}

.dark .mermaid .note text {
    fill: #1e293b !important;
}
